\section{Problem Statement}


In contrast to the previous section, where we focused on enforcing a hard allocation constraint to achieve group fairness by quantity. We may consider the alternative where we provide incentives to satisfy group fairness by quantity instead by imposing a penalty function on the utility of each group, where the penalty gradually decreases to 0 as the number of allocations to the group approaches its desired allocation quantity $ m_j $ to discourage under allocation, and increases afterwards to discourage over allocation. We shall refer to this setting as the soft quota setting onwards.


\begin{definition}[\textbf{Soft-Quota Setting}]
    Consider a set of buyer groups $[K]$, where each group $j \in [K]$ is associated with a penalty function $f_j: \mathbb{R}_+ \to \mathbb{R}_+$. Each function $f_j$ is continuous on $[0, \infty)$, attains its minimum value of 0 at $m_j$, is non-increasing on $[0, m_j]$, and non-decreasing on $[m_j, \infty)$.
\end{definition}


Given an allocation $ \mathbf{x} \in \mathbb{R}_+^T $, the total value for group $ j $ is given by $ \mathcal{V}_j(\mathbf{x}) = \sum_{t \in [T]} v_t x_t \cdot  \boldsymbol{1}_{\{j_t = j\}} $, its utility is equal to its value for the allocation, subtracted by the penalty function, i.e., $ \mathcal{U}_j(\mathbf{x}) = \mathcal{V}_j(\mathbf{x}) - f_j(\sum_{t\in [T]} x_t \cdot \boldsymbol{1}_{\{j_t = j\}}) $.

Our objective is then to maximize the overall social welfare $\mathcal{W}(\mathbf{x}) = \sum_{j\in [K]} \mathcal{U}_j(\mathbf{x}) $. For an arrival instance $ I $, the offline optimal performance $ \OPT(I) $ can obtained by solving the following optimization problem:

\begin{subequations}\label{equation-soft-quota-primal}
    \begin{align}
        \max_{x_t\in[0, r_t]} & \sum_{j\in [K]} \left\{\mathcal{V}_j(\mathbf{x}) - f_j\left(\sum_{t\in [T]} x_t \cdot \boldsymbol{1}_{\{j_t = j\}} \right)\right\} \\
        \text{s.t.} \quad     & \sum_{t\in[T]} x_t \leq B.
    \end{align}
\end{subequations}

We begin with the same assumption that there are sufficient arrivals in each group to meet its requirement; otherwise, it would be unreasonable to impose a positive penalty for missing it.
\begin{assumption}[\textbf{Soft-Quota Satisfiability}] \label{assumption-soft-quota-satisfiability}
    For each group $ j\in [K] $, there are at least $ n_j $ arrivals where $ n_j = \arg\min_n \sum_{t\in[n]} r_t\cdot \boldsymbol{1}_{\{j_t = j\}} \geq m_j $ denotes the smallest integer that ensures the satisfiability of the quota requirement $ m_j $.
\end{assumption}

For a given set of desired allocations $ \{m_j\}_{j\in[K]} $, we denote the total desired allocations across all groups as $ M = \sum_{j\in [K]} m_j $. We assume that the capacity $ B $ is large enough to accommodate the total desired allocations across all groups.
\begin{assumption}[\textbf{Soft-Quota Capacity}] \label{assumption-soft-quota-capacity}
    The total desired allocations across all groups do not exceed the overall capacity $ B $, i.e., $ M = \sum_{j\in [K]} m_j \leq B $.
\end{assumption}


\begin{assumption}[\textbf{Soft-Quota Bounded Values}]\label{assumption-soft-quota-bounded-values}
    Each agent's value $ v_t $ is bounded within the same interval $ [1, \theta] $, where $ \theta > 1 $ is a constant, regardless of their group identity $ j_t $.
\end{assumption}


In this section, we focus on three types of penalty functions: linear-to-zero, zero-to-linear, and linear-to-linear functions.

\paragraph{Linear-to-zero Penalties.} Consider the case where the penalty function $ f_j $ for each group $ j $ is linearly decreasing before its desired allocation amount $ m_j $ and 0 afterwards. Namely, we have:
\begin{align*}
    f_j(x) = \begin{cases}
                 f_j^L(x) = -\beta_j x + \beta_j m_j, x\in [0, m_j], \\
                 f_j^R(x) = 0, x\in [m_j, \infty),
             \end{cases}
\end{align*}

The offline optimization problem can then be expressed as follows:
\begin{subequations}\label{equation-linear2zero-soft-quota-primal}
    \begin{align}
        \max_{0 \leq x_t \leq r_t}\quad
         & \sum_{t \in [T]} v_tx_t -
        \sum_{j \in [K]}
        \beta_j
        \Bigl[\,m_j - \sum_{t=1}^{T} x_t \cdot\mathbf 1_{\{j_t = j\}}\Bigr]^{+} \\[6pt]
        \text{s.t.}\quad
         & \sum_{t=1}^{T} x_t \leq B
    \end{align}
\end{subequations}

\paragraph{Remark} We may take an alternative view of the optimization problem by considering it as a subsidy of $ \beta_j $ for the first $ m_j $ units of allocation to group $ j $. In this case, the optimization problem can be reformulated as follows,
\begin{subequations}\label{equation-linear2zero-subsidy}
    \begin{align}
        \max_{0 \leq x_t \leq r_t}\quad
         & \sum_{t \in [T]} (v_t + \beta_{j_t}) x_t -
        \sum_{j \in [K]}
        \beta_j
        \Bigl[\sum_{t \in [T]} x_t \cdot \mathbf{1}_{\{j_t = j\}} - m_j\Bigr]^{+} \\[6pt]
        \text{s.t.}\quad
         & \sum_{t=1}^{T} x_t \leq B
    \end{align}
\end{subequations}.

\paragraph{Zero-to-linear Penalties.}We also consider the case where the penalty function $ f_j $ for each group $ j $ is 0 before its desired allocation amount $ m_j $ and linearly increasing afterwards. Namely, we have:
\begin{align*}
    f_j(x) = \begin{cases}
                 f_j^L(x) = 0, x\in [0, m_j], \\
                 f_j^R(x) = \bar {\beta}_jx - \bar{\beta}_j m_j, x\in [m_j, \infty),
             \end{cases}
\end{align*}

The offline optimization problem can then be expressed as follows:
\begin{subequations}\label{equation-zero2linear-soft-quota-primal}
    \begin{align}
        \max_{0 \leq x_t \leq r_t}\quad
         & \sum_{t \in [T]} v_tx_t -
        \sum_{j \in [K]}
        \bar{\beta}_j
        \Bigl[\sum_{t=1}^{T} x_t \cdot\mathbf 1_{\{j_t = j\}} - m_j\Bigr]^{+} \\[6pt]
        \text{s.t.}\quad
         & \sum_{t=1}^{T} x_t \leq B
    \end{align}
\end{subequations}
In this case, it is straightforward to see that the penalty term can be interpreted as a direct cost for exceeding the desired allocation amount $ m_j $ for each group $ j $.

In this case, we impose an additional assumption on the penalty parameters to ensure that the it is always beneficial to allocate more by guaranteeing that the marginal value is always greater than the marginal penalty.

\begin{assumption}[\textbf{Zero-to-Linear Penalty High Value}]
    \label{assumption-zero2linear-high-value}
    For each group $ j \in [K] $, its penalty parameter $ \bar{\beta}_j $ satisfies $ \bar{\beta}_j \in [0,1] $.
\end{assumption}

Without loss of generality, we assume $ \bar \beta_1 \leq \bar \beta_2 \leq \ldots \leq \bar \beta_K $.

\paragraph{Linear-to-linear Penalties.} Finally, we consider the combination of the previous two cases, where the penalty function $ f_j $ for each group $ j $ is linearly decreasing before its desired allocation amount $ m_j $ and linearly increasing afterwards. Namely, we have:
\begin{align*}
    f_j(x) = \begin{cases}
                 f_j^L(x) = -\beta_j x + \beta_j m_j, x\in [0, m_j], \\
                 f_j^R(x) = \bar {\beta}_jx - \bar{\beta}_j m_j, x\in [m_j, \infty),
             \end{cases}
\end{align*}
The offline optimization problem can then be expressed as follows:
\begin{subequations}\label{equation-linear2linear-soft-quota-primal}
    \begin{align}
        \max_{0 \leq x_t \leq r_t}\quad
         & \sum_{t \in [T]} v_tx_t -
        \sum_{j \in [K]}
        \left\{
        \beta_j
        \Bigl[\,m_j - \sum_{t=1}^{T} x_t \cdot\mathbf 1_{\{j_t = j\}}\Bigr]^{+} +
        \bar{\beta}_j
        \Bigl[\sum_{t=1}^{T} x_t \cdot\mathbf 1_{\{j_t = j\}} - m_j\Bigr]^{+}
        \right\}                     \\[6pt]
        \text{s.t.}\quad
         & \sum_{t=1}^{T} x_t \leq B
    \end{align}
\end{subequations}

This case combines the interpretations of both previous cases, where we provide a subsidy of $ \beta_j $ for the first $ m_j $ units of allocation to group $ j $, and impose a cost of $ \bar{\beta}_j $ for exceeding the desired allocation amount $ m_j $ for each group $ j $. And we impose the same assumption on the penalty parameters as in Assumption \ref{assumption-zero2linear-high-value}.


\section{Main Results}\label{section-main-results-soft-quota}
\input{body/ch4-mainResults.tex}


\section{Proof Outline}
\input{body/ch4-proofOutline.tex}

% \section{Zero-to-Linear Penalties}

% \input{body/ch4-01-Z2L.tex}

% \section{Linear-to-Zero Penalties}

% \input{body/ch4-02-L2Z.tex}


% \section{Linear-to-Linear Penalties}

% \input{body/ch4-03-L2L.tex}
